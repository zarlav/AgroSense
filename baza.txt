CREATE TABLE agrosense.proizvodne_jedinice (
    tip_jedinice text,
    aktivno boolean,
    id_jedinice uuid,
    datum_postavljanja timestamp,
    geo_lat double,
    geo_long double,
    granica_co2_max float,
    granica_co2_min float,
    granica_jacina_vetra_max float,
    granica_jacina_vetra_min float,
    granica_pritisak_u_cevima_max float,
    granica_pritisak_u_cevima_min float,
    granica_pritisak_vazduha_max float,
    granica_pritisak_vazduha_min float,
    granica_svetlost_max float,
    granica_svetlost_min float,
    granica_temp_max float,
    granica_temp_min float,
    granica_vlaznost_lista_max float,
    granica_vlaznost_lista_min float,
    granica_vlaznost_max float,
    granica_vlaznost_min float,
    nadmorska_visina double,
    naziv text,
    odgovorno_lice text,
    opis text,
    povrsina float,
    status_mreze text,
    vrsta_biljaka text,
    PRIMARY KEY ((tip_jedinice, aktivno), id_jedinice)
) WITH CLUSTERING ORDER BY (id_jedinice ASC)


CREATE TABLE agrosense.proizvodne_jedinice_aktivne (
    aktivno boolean,
    id_jedinice uuid,
    tip_jedinice text,
    PRIMARY KEY (aktivno, id_jedinice)
) WITH CLUSTERING ORDER BY (id_jedinice ASC)

CREATE TABLE agrosense.alarmi (
    id_jedinice uuid,
    dan date,
    vreme_dogadjaja timestamp,
    id_alarma timeuuid,
    granicna_vrednostmax double,
    granicna_vrednostmin double,
    id_senzora uuid,
    komentar text,
    parametar text,
    trenutna_vrednost double,
    PRIMARY KEY ((id_jedinice, dan), vreme_dogadjaja, id_alarma)
) WITH CLUSTERING ORDER BY (vreme_dogadjaja DESC, id_alarma ASC)

CREATE TABLE agrosense.alarmi_po_senzoru (
    id_senzora uuid,
    dan date,
    vreme_dogadjaja timestamp,
    id_alarma timeuuid,
    id_jedinice uuid,
    komentar text,
    PRIMARY KEY ((id_senzora, dan), vreme_dogadjaja, id_alarma)
) WITH CLUSTERING ORDER BY (vreme_dogadjaja DESC, id_alarma DESC)

CREATE TABLE agrosense.korisnik (
    id_korisnika UUID PRIMARY KEY,
    ime TEXT,
    uloga TEXT,
    kontakt TEXT,
    aktivan BOOLEAN
);
CREATE TABLE agrosense.korisnik_po_jedinici (
    id_jedinice UUID,
    id_korisnika UUID,
    uloga TEXT,
    PRIMARY KEY (id_jedinice, id_korisnika)
);


CREATE TABLE agrosense.senzor_podatak_po_danu (
    id_senzora uuid,
    dan date,
    ts timestamp,
    co2 float,
    id_lokacije uuid,
    jacina_vetra float,
    ph_zemljista float,
    pritisak_u_cevima float,
    pritisak_vazduha float,
    smer_vetra text,
    temperatura float,
    uv_vrednost float,
    vlaznost float,
    vlaznost_lista float,
    PRIMARY KEY ((id_senzora, dan), ts)
) WITH CLUSTERING ORDER BY (ts DESC);


CREATE TABLE agrosense.senzor (
    id_senzora uuid PRIMARY KEY,
    id_lokacije uuid,
    model text,
    naziv text,
    proizvodjac text,
    status text,
    vreme_instalacije timestamp
);
CREATE TABLE IF NOT EXISTS agrosense.senzor_po_lokaciji (
    id_lokacije uuid,
    id_senzora uuid,
    model text,
    naziv text,
    proizvodjac text,
    status text,
    vreme_instalacije timestamp,
    PRIMARY KEY (id_lokacije, id_senzora)
) WITH CLUSTERING ORDER BY (id_senzora ASC);


CREATE TABLE agrosense.senzor_poslednja_vrednost (
    id_senzora uuid PRIMARY KEY,
    co2 float,
    dan date,
    id_lokacije uuid,
    jacina_vetra float,
    ph_zemljista float,
    pritisak_u_cevima float,
    pritisak_vazduha float,
    smer_vetra text,
    temperatura float,
    ts timestamp,
    uv_vrednost float,
    vlaznost float,
    vlaznost_lista float
);

CREATE TABLE agrosense.senzor_podatak_po_lokaciji (
    id_lokacije uuid,
    dan date,
    ts timestamp,
    id_senzora uuid,
    co2 float,
    jacina_vetra float,
    ph_zemljista float,
    pritisak_u_cevima float,
    pritisak_vazduha float,
    smer_vetra text,
    temperatura float,
    uv_vrednost float,
    vlaznost float,
    vlaznost_lista float,
    PRIMARY KEY ((id_lokacije, dan), ts, id_senzora)
) WITH CLUSTERING ORDER BY (ts DESC, id_senzora ASC)
