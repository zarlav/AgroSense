CREATE TABLE IF NOT EXISTS agrosense.proizvodne_jedinice (
    tip_jedinice text,
    id_jedinice uuid,
    aktivno boolean,
    datum_postavljanja timestamp,
    geo_lat double,
    geo_long double,
    granica_co2_max float, 
    granica_co2_min float,
    granica_jacina_vetra_max float,
    granica_jacina_vetra_min float,
    granica_pritisak_u_cevima_max float,
    granica_pritisak_u_cevima_min float,
    granica_pritisak_vazduha_max float,
    granica_pritisak_vazduha_min float,
    granica_svetlost_max float, 
    granica_svetlost_min float,
    granica_temp_max float,
    granica_temp_min float,
    granica_vlaznost_lista_max float,
    granica_vlaznost_lista_min float,
    granica_vlaznost_max float,
    granica_vlaznost_min float,
    nadmorska_visina double,
    naziv text, 
    odgovorno_lice text,
    opis text,
    povrsina float,
    status_mreze text,
    vrsta_biljaka text,

    PRIMARY KEY ((tip_jedinice, aktivno), id_jedinice))

CREATE TABLE agrosense.proizvodne_jedinice_aktivne (
    tip_jedinice text,
    aktivno boolean,
    id_jedinice uuid,
    PRIMARY KEY (aktivno, id_jedinice)
);

//////////////////////ALARMI//////////////////////////////
CREATE TABLE IF NOT EXISTS agrosense.alarmi (
    id_jedinice UUID,
    dan date,
    vreme_dogadjaja timestamp,
    id_alarma UUID,
    id_senzora UUID,
    tip_senzora TEXT,
    parametar TEXT,
    trenutna_vrednost DOUBLE,
    granicna_vrednost DOUBLE,
    stanje_pre TEXT,
    stanje_posle TEXT,
    prioritet TEXT,
    komentar TEXT,
    vreme_aktivacije TIMESTAMP,
    automatizovana_akcija BOOLEAN,

    PRIMARY KEY ((id_jedinice, dan), vreme_dogadjaja , id_senzora)
)
WITH CLUSTERING ORDER BY (vreme_dogadjaja DESC);


CREATE TABLE agrosense.alarmi_po_senzoru (
    id_senzora UUID,
    dan DATE,
    vreme_dogadjaja TIMESTAMP,
    id_jedinice UUID,
    prioritet TEXT,
    parametar TEXT,

    PRIMARY KEY ((id_senzora, dan), vreme_dogadjaja)
)
WITH CLUSTERING ORDER BY (vreme_dogadjaja DESC);

CREATE TABLE agrosense.alarmi_po_prioritetu (
    prioritet TEXT,
    dan DATE,
    vreme_dogadjaja TIMESTAMP,
    id_jedinice UUID,
    id_senzora UUID,
    parametar TEXT,
    trenutna_vrednost DOUBLE,

    PRIMARY KEY ((prioritet, dan), vreme_dogadjaja, id_jedinice)
)
WITH CLUSTERING ORDER BY (vreme_dogadjaja DESC);


/////////////////////////KORISNIK//////////////////////
CREATE TABLE agrosense.korisnik (
    id_korisnika UUID PRIMARY KEY,
    ime TEXT,
    uloga TEXT,
    kontakt TEXT,
    aktivan BOOLEAN
);
CREATE TABLE agrosense.korisnik_po_jedinici (
    id_jedinice UUID,
    id_korisnika UUID,
    uloga TEXT,
    PRIMARY KEY (id_jedinice, id_korisnika)
);



///////////////////////// SENZORI//////////////////////

CREATE TABLE IF NOT EXISTS agrosense.senzor_podatak_po_danu (
    id_senzora UUID,
    dan DATE,
    ts TIMESTAMP,
    temperatura FLOAT,
    vlaznost FLOAT,
    co2 FLOAT,
    jacina_vetra FLOAT,
    smer_vetra TEXT,
    ph_zemljista FLOAT,
    uv_vrednost FLOAT,
    vlaznost_lista FLOAT,
    pritisak_vazduha FLOAT,
    pritisak_u_cevima FLOAT,

    PRIMARY KEY((id_senzora , dan), ts)
) WITH CLUSTERING ORDER BY (ts DESC);


CREATE TABLE IF NOT EXISTS agrosense.senzor (
    id_senzora UUID PRIMARY KEY,
    id_lokacije UUID,
    tip TEXT,
    status TEXT
);
CREATE TABLE agrosense.senzor_health (
    id_senzora UUID PRIMARY KEY,
    last_seen TIMESTAMP,
    battery_level INT,
    signal_strength INT,
    status TEXT
);
CREATE TABLE IF NOT EXISTS agrosense.senzor_po_lokaciji (
    id_senzora UUID,
    id_lokacije UUID,
    tip TEXT,
    status TEXT,
    PRIMARY KEY(id_lokacije,id_senzora)
);

CREATE TABLE IF NOT EXISTS agrosense.senzor_podatak_po_vremenu (
    id_senzora UUID,
    id_lokacije UUID,
    dan DATE,
    ts TIMESTAMP,
    temperatura FLOAT,
    vlaznost FLOAT,
    co2 FLOAT,
    jacina_vetra FLOAT,
    smer_vetra TEXT,
    ph_zemljista FLOAT,
    uv_vrednost FLOAT,
    vlaznost_lista FLOAT,
    pritisak_vazduha FLOAT,
    pritisak_u_cevima FLOAT,

    PRIMARY KEY ((dan,id_lokacije), ts, id_senzora)
)WITH CLUSTERING ORDER BY (ts DESC);

CREATE TABLE IF NOT EXISTS agrosense.senzor_poslednja_vrednost (
    id_senzora UUID PRIMARY KEY,
    ts TIMESTAMP,
    temperatura FLOAT,
    vlaznost FLOAT,
    co2 FLOAT,
    jacina_vetra FLOAT,
    smer_vetra TEXT,
    ph_zemljista FLOAT,
    uv_vrednost FLOAT,
    vlaznost_lista FLOAT,
    pritisak_vazduha FLOAT,
    pritisak_u_cevima FLOAT
);  

CREATE TABLE agrosense.senzor_agregat_dnevni (
    id_lokacije UUID,
    dan DATE,
    parametar TEXT,        
    avg_vrednost DOUBLE,
    min_vrednost DOUBLE,
    max_vrednost DOUBLE,

    PRIMARY KEY ((id_lokacije, dan), parametar)
);
